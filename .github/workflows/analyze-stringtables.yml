name: Save old stringtable.ini if changed
on:
  push:

jobs:
  extract-old:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2  # potrzebne do uzyskania HEAD~1

      - name: Check if stringtable.ini changed
        id: diffcheck
        run: |
          CHANGED=$(git diff --name-only HEAD~1 HEAD | grep stringtable.ini || true)
          echo "changed_file=$CHANGED" >> $GITHUB_OUTPUT

      - name: Save previous version as stringtable_old.ini
        if: steps.diffcheck.outputs.changed_file != ''
        run: |
          mkdir -p tmp
          git show HEAD~1:stringtable.ini > tmp/stringtable_old.ini
          echo "Zawartość sprzed commita zapisana do tmp/stringtable_old.ini"

      - name: Show saved file (debug)
        if: steps.diffcheck.outputs.changed_file != ''
        run: |
          echo "--- OLD FILE ---"
          cat tmp/stringtable_old.ini
