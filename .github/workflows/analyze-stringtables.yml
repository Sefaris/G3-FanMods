name: Save old stringtable.ini if changed
on:
  push:

jobs:
  extract-old:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2  # potrzebne do uzyskania HEAD~1

      - name: Znajdź zmienione pliki stringtable.ini
        id: diffcheck
        run: |
          # Szukamy plików o nazwie stringtable.ini
          CHANGED_FILE=$(git diff --name-only HEAD~1 HEAD | grep stringtable.ini || true)
          echo "Znaleziony zmieniony plik: $CHANGED_FILE"
          echo "changed_file=$CHANGED_FILE" >> $GITHUB_OUTPUT

      - name: Zapisz starą wersję jako stringtable_old.ini
        if: steps.diffcheck.outputs.changed_file != ''
        run: |
          mkdir -p tmp
          FILE="${{ steps.diffcheck.outputs.changed_file }}"
          
          # Czy plik istniał wcześniej?
          if git ls-tree -r HEAD~1 --name-only | grep -q "^$FILE$"; then
            git show HEAD~1:$FILE > tmp/stringtable_old.ini
            echo "Poprzednia wersja pliku $FILE została zapisana jako tmp/stringtable_old.ini"
          else
            echo "Plik $FILE nie istniał w HEAD~1 – nie zapisano starej wersji."
          fi

      - name: (Opcjonalnie) pokaż zawartość tmp/stringtable_old.ini
        if: steps.diffcheck.outputs.changed_file != ''
        run: |
          echo "--- Zawartość tmp/stringtable_old.ini ---"
          cat tmp/stringtable_old.ini || echo "Plik nie istnieje"
